<script src="https://www.gstatic.com/charts/loader.js"></script>
<script src="chartkick.js"></script>

<div class="row">
  <h1>Metrics</h1>
  <div class="pull-right range-query">
    <%= form_tag metrics_path, method: :get do %>
      <%= text_field_tag 'search[date_from]', @search.date_from %>
      <%= text_field_tag 'search[date_to]', @search.date_to %>
      <%= submit_tag 'Search', class: 'btn search-button' %>
    <% end %>
  </div>
</div>

<h3>Total active students</h3>
<%= line_chart @club.daily_metrics.group_by_week(:created_at, range: @from..@to).maximum(:total_active_students), library: { animation: { easing: 'easeOutQuad'}} %>
<h3>Lost students</h3>
<%= line_chart @club.daily_metrics.group_by_week(:created_at, range: @from..@to).sum(:lost_students), library: { animation: { easing: 'easeOutQuad'}} %>
<h3>New students</h3>
<%= line_chart @club.daily_metrics.group_by_week(:created_at, range: @from..@to).sum(:new_students), library: { animation: { easing: 'easeOutQuad'}} %>
<h3>Revenue</h3>
<%= line_chart @club.daily_metrics.group_by_week(:created_at, range: @from..@to).sum(:revenue), library: { animation: { easing: 'easeOutQuad'}} %>
<h3>Average no. of students per session</h3>
<h3>Average length of membership (days)</h3>
<h3>Retention rate/churn</h3>